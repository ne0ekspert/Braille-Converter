#define RAND_MAX 56
#include <SoftwareSerial.h>
#include <MD_Parola.h>
#include <MD_MAX72xx.h>
#include <ArduinoJson.h>

SoftwareSerial bluetooth(2, 3);
MD_Parola display = MD_Parola(MD_MAX72XX::GENERIC_HW, 12, 10, 11, 3);

MD_MAX72XX::fontType_t newFont[] PROGMEM = {
	'F', 2, 0, 0, 0, 255, 8,
	2, 0, 0, 	// 0
	2, 0, 4, 	// 1
	2, 0, 2, 	// 2
	2, 0, 6, 	// 3
	2, 0, 1, 	// 4
	2, 0, 5, 	// 5
	2, 0, 3, 	// 6
	2, 0, 7, 	// 7
	2, 4, 0, 	// 8
	2, 4, 4, 	// 9
	2, 4, 2, 	// 10
	2, 4, 6, 	// 11
	2, 4, 1, 	// 12
	2, 4, 5, 	// 13
	2, 4, 3, 	// 14
	2, 4, 7, 	// 15
	2, 2, 0, 	// 16
	2, 2, 4, 	// 17
	2, 2, 2, 	// 18
	2, 2, 6, 	// 19
	2, 2, 1, 	// 20
	2, 2, 5, 	// 21
	2, 2, 3, 	// 22
	2, 2, 7, 	// 23
	2, 6, 0, 	// 24
	2, 6, 4, 	// 25
	2, 6, 2, 	// 26
	2, 6, 6, 	// 27
	2, 6, 1, 	// 28
	2, 6, 5, 	// 29
	2, 6, 3, 	// 30
	2, 6, 7, 	// 31
	2, 1, 0, 	// 32
	2, 1, 4, 	// 33
	2, 1, 2, 	// 34
	2, 1, 6, 	// 35
	2, 1, 1, 	// 36
	2, 1, 5, 	// 37
	2, 1, 3, 	// 38
	2, 1, 7, 	// 39
	2, 5, 0, 	// 40
	2, 5, 4, 	// 41
	2, 5, 2, 	// 42
	2, 5, 6, 	// 43
	2, 5, 1, 	// 44
	2, 5, 5, 	// 45
	2, 5, 3, 	// 46
	2, 5, 7, 	// 47
	2, 3, 0, 	// 48
	2, 3, 4, 	// 49
	2, 3, 2, 	// 50
	2, 3, 6, 	// 51
	2, 3, 1, 	// 52
	2, 3, 5, 	// 53
	2, 3, 3, 	// 54
	2, 3, 7, 	// 55
	2, 7, 0, 	// 56
	2, 7, 4, 	// 57
	2, 7, 2, 	// 58
	2, 7, 6, 	// 59
	2, 7, 1, 	// 60
	2, 7, 5, 	// 61
	2, 7, 3, 	// 62
	2, 7, 7, 	// 63
	0, 	// 64
	0, 	// 65
	0, 	// 66
	0, 	// 67
	0, 	// 68
	0, 	// 69
	0, 	// 70
	0, 	// 71
	0, 	// 72
	0, 	// 73
	0, 	// 74
	0, 	// 75
	0, 	// 76
	0, 	// 77
	0, 	// 78
	0, 	// 79
	0, 	// 80
	0, 	// 81
	0, 	// 82
	0, 	// 83
	0, 	// 84
	0, 	// 85
	0, 	// 86
	0, 	// 87
	0, 	// 88
	0, 	// 89
	0, 	// 90
	0, 	// 91
	0, 	// 92
	0, 	// 93
	0, 	// 94
	0, 	// 95
	0, 	// 96
	0, 	// 97
	0, 	// 98
	0, 	// 99
	0, 	// 100
	0, 	// 101
	0, 	// 102
	0, 	// 103
	0, 	// 104
	0, 	// 105
	0, 	// 106
	0, 	// 107
	0, 	// 108
	0, 	// 109
	0, 	// 110
	0, 	// 111
	0, 	// 112
	0, 	// 113
	0, 	// 114
	0, 	// 115
	0, 	// 116
	0, 	// 117
	0, 	// 118
	0, 	// 119
	0, 	// 120
	0, 	// 121
	0, 	// 122
	0, 	// 123
	0, 	// 124
	0, 	// 125
	0, 	// 126
	0, 	// 127
	0, 	// 128
	0, 	// 129
	0, 	// 130
	0, 	// 131
	0, 	// 132
	0, 	// 133
	0, 	// 134
	0, 	// 135
	0, 	// 136
	0, 	// 137
	0, 	// 138
	0, 	// 139
	0, 	// 140
	0, 	// 141
	0, 	// 142
	0, 	// 143
	0, 	// 144
	0, 	// 145
	0, 	// 146
	0, 	// 147
	0, 	// 148
	0, 	// 149
	0, 	// 150
	0, 	// 151
	0, 	// 152
	0, 	// 153
	0, 	// 154
	0, 	// 155
	0, 	// 156
	0, 	// 157
	0, 	// 158
	0, 	// 159
	0, 	// 160
	0, 	// 161
	0, 	// 162
	0, 	// 163
	0, 	// 164
	0, 	// 165
	0, 	// 166
	0, 	// 167
	0, 	// 168
	0, 	// 169
	0, 	// 170
	0, 	// 171
	0, 	// 172
	0, 	// 173
	0, 	// 174
	0, 	// 175
	0, 	// 176
	0, 	// 177
	0, 	// 178
	0, 	// 179
	0, 	// 180
	0, 	// 181
	0, 	// 182
	0, 	// 183
	0, 	// 184
	0, 	// 185
	0, 	// 186
	0, 	// 187
	0, 	// 188
	0, 	// 189
	0, 	// 190
	0, 	// 191
	0, 	// 192
	0, 	// 193
	0, 	// 194
	0, 	// 195
	0, 	// 196
	0, 	// 197
	0, 	// 198
	0, 	// 199
	0, 	// 200
	0, 	// 201
	0, 	// 202
	0, 	// 203
	0, 	// 204
	0, 	// 205
	0, 	// 206
	0, 	// 207
	0, 	// 208
	0, 	// 209
	0, 	// 210
	0, 	// 211
	0, 	// 212
	0, 	// 213
	0, 	// 214
	0, 	// 215
	0, 	// 216
	0, 	// 217
	0, 	// 218
	0, 	// 219
	0, 	// 220
	0, 	// 221
	0, 	// 222
	0, 	// 223
	0, 	// 224
	0, 	// 225
	0, 	// 226
	0, 	// 227
	0, 	// 228
	0, 	// 229
	0, 	// 230
	0, 	// 231
	0, 	// 232
	0, 	// 233
	0, 	// 234
	0, 	// 235
	0, 	// 236
	0, 	// 237
	0, 	// 238
	0, 	// 239
	0, 	// 240
	0, 	// 241
	0, 	// 242
	0, 	// 243
	0, 	// 244
	0, 	// 245
	0, 	// 246
	0, 	// 247
	0, 	// 248
	0, 	// 249
	0, 	// 250
	0, 	// 251
	0, 	// 252
	0, 	// 253
	0, 	// 254
	0, 	// 255
};

void setup() {
  Serial.begin(115200);
  bluetooth.begin(9600);

  display.begin();
  display.setIntensity(3);
  display.displayClear();
  display.displayReset();
  display.setFont(newFont);
  display.setSpeedInOut(100, 100);
  display.setPause(10 * display.getSpeed());
  display.setTextAlignment(PA_CENTER);
  display.setInvert(false);
  display.setCharSpacing(0);
  srand(123123);
}

DynamicJsonDocument doc(1024);
char combined[256]; // Adjust size as needed


void loop() {
  if(Serial.available()) {
	char c = Serial.read();
	if (c) {
		for (int i=0;i<16;i++) {
			combined[i] = rand()+2;
			while (combined[i] < 2 || combined[i] > 60) {
				combined[i] = rand()+2;
			}
		}
		combined[7] = NULL;
	}
 	display.displayText(combined, PA_LEFT, 100, 0, PA_NO_EFFECT, PA_NO_EFFECT);
  }

  display.synchZoneStart();
  display.displayAnimate();
}
